package wtf.monsoon.client.modules.exploit.disabler

import me.bush.eventbuskotlin.EventListener
import me.bush.eventbuskotlin.listener
import net.minecraft.entity.player.PlayerCapabilities
import net.minecraft.network.Packet
import net.minecraft.network.play.client.C03PacketPlayer
import net.minecraft.network.play.client.C0FPacketConfirmTransaction
import net.minecraft.network.play.client.C13PacketPlayerAbilities
import net.minecraft.network.play.client.C18PacketSpectate
import wtf.monsoon.backend.module.MulticlassModule
import wtf.monsoon.backend.module.mode.ModuleMode
import wtf.monsoon.backend.setting.Setting
import wtf.monsoon.client.event.EventPacket
import wtf.monsoon.client.event.EventPreMotion
import wtf.monsoon.client.modules.exploit.Disabler
import wtf.monsoon.client.util.math.randomNumber
import wtf.monsoon.client.util.misc.Stopwatch
import wtf.monsoon.client.util.network.PacketUtil
import java.util.concurrent.LinkedBlockingQueue

class SpectateDisabler(name: String, parent: MulticlassModule) : ModuleMode<Disabler>(name, parent) {

    private var specBehaviorSpoof = Setting<Boolean>("Spectator Behavior Spoof", false)

    init {
        this.registerSettings(specBehaviorSpoof)
    }

    @EventListener
    val packetEvent = fun(e: EventPacket) {
        if (e.packet is C03PacketPlayer) {
            PacketUtil.sendPacketNoEvent(C18PacketSpectate(mc.thePlayer.uniqueID))

            if(specBehaviorSpoof.getValue()) {
                (e.packet as C03PacketPlayer).onGround = false
                val cap = PlayerCapabilities()
                cap.isFlying = true
                cap.allowFlying = true
                cap.disableDamage = true
                cap.isCreativeMode = mc.thePlayer.capabilities.isCreativeMode
                cap.flySpeed = mc.thePlayer.capabilities.flySpeed
                cap.walkSpeed = mc.thePlayer.capabilities.walkSpeed
                PacketUtil.sendPacketNoEvent(C13PacketPlayerAbilities(cap))
            }
        }
    }
}