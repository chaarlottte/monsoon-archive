package wtf.monsoon.client.modules.exploit.disabler

import me.bush.eventbuskotlin.EventListener
import me.bush.eventbuskotlin.listener
import net.minecraft.network.play.client.C03PacketPlayer
import net.minecraft.network.play.client.C08PacketPlayerBlockPlacement
import net.minecraft.network.play.client.C0BPacketEntityAction
import net.minecraft.network.play.server.S08PacketPlayerPosLook
import net.minecraft.realms.RealmsMth.sqrt
import net.minecraft.util.BlockPos
import wtf.monsoon.backend.module.MulticlassModule
import wtf.monsoon.backend.module.mode.ModuleMode
import wtf.monsoon.client.event.EventPacket
import wtf.monsoon.client.event.EventPreMotion
import wtf.monsoon.client.modules.exploit.Disabler
import wtf.monsoon.client.util.network.PacketUtil

class SetbackDisabler(name: String, parent: MulticlassModule) : ModuleMode<Disabler>(name, parent) {

    @EventListener
    val eventPacket = fun(e: EventPacket) {
        if (e.packet is S08PacketPlayerPosLook) {
            val packet = e.packet as S08PacketPlayerPosLook
            val x = packet.x - mc.thePlayer.posX
            val y = packet.y - mc.thePlayer.posY
            val z = packet.z - mc.thePlayer.posZ
            val diff = sqrt(x * x + y * y + z * z)
            if (diff <= 8) {
                e.cancel()
                PacketUtil.sendPacketNoEvent(C03PacketPlayer.C06PacketPlayerPosLook(packet.x, packet.y, packet.z, packet.yaw, packet.pitch, true))
            }
        }
    }
}