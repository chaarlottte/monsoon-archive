package wtf.monsoon.client.modules.exploit.disabler

import me.bush.eventbuskotlin.EventListener
import me.bush.eventbuskotlin.listener
import net.minecraft.network.play.client.C08PacketPlayerBlockPlacement
import net.minecraft.network.play.client.C0BPacketEntityAction
import net.minecraft.util.BlockPos
import wtf.monsoon.backend.module.MulticlassModule
import wtf.monsoon.backend.module.mode.ModuleMode
import wtf.monsoon.client.event.EventPacket
import wtf.monsoon.client.event.EventPreMotion
import wtf.monsoon.client.modules.exploit.Disabler
import wtf.monsoon.client.util.network.PacketUtil

class CubecraftDisabler(name: String, parent: MulticlassModule) : ModuleMode<Disabler>(name, parent) {


    @EventListener
    val eventPacket = fun(e: EventPacket) {
        if (e.packet is C0BPacketEntityAction) {
            val packet = e.packet as C0BPacketEntityAction
            if (packet.action == C0BPacketEntityAction.Action.START_SPRINTING) {
                packet.action = C0BPacketEntityAction.Action.STOP_SPRINTING
            }
        }
    }

    @EventListener
    val preMotion = fun(e: EventPreMotion) {
        e.onGround = true
        PacketUtil.sendPacketNoEvent(
            C08PacketPlayerBlockPlacement(
                BlockPos(
                    mc.thePlayer.posX,
                    mc.thePlayer.posY,
                    mc.thePlayer.posZ
                ), 0, null, 0.0f, Math.random().toFloat() / 5f, 0.0f
            )
        )
    }
}