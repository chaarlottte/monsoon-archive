package wtf.monsoon.client.modules.exploit

import me.bush.eventbuskotlin.EventListener
import me.bush.eventbuskotlin.listener
import net.minecraft.network.Packet
import net.minecraft.network.play.client.C03PacketPlayer
import wtf.monsoon.backend.Category
import wtf.monsoon.backend.module.Module
import wtf.monsoon.client.event.EventClientTick
import wtf.monsoon.client.event.EventPacket
import wtf.monsoon.client.event.EventUpdate
import wtf.monsoon.client.util.network.PacketUtil
import java.util.concurrent.LinkedBlockingQueue

class Blink : Module("Blink", "Stop packets while enabled.", Category.EXPLOIT) {

    private val packets = LinkedBlockingQueue<Packet<*>>()

    override var metadata: () -> String = { this.packets.size.toString() }

    override fun disable() {
        super.disable()
        releaseBlink()
    }

    @EventListener
    val eventPacket = fun(e: EventPacket) {
        if (e.packet is C03PacketPlayer) {
            this.packets.add(e.packet)
            e.cancel()
        }
    }

    private fun releaseBlink() {
        while (!packets.isEmpty()) {
            PacketUtil.sendPacketNoEvent(packets.poll())
        }
    }

}