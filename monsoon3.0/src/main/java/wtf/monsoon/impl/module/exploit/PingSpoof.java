package wtf.monsoon.impl.module.exploit;

import io.github.nevalackin.homoBus.Listener;
import io.github.nevalackin.homoBus.annotations.EventLink;
import lombok.Getter;
import net.minecraft.network.play.client.C00PacketKeepAlive;
import net.minecraft.network.play.client.C0FPacketConfirmTransaction;
import wtf.monsoon.api.module.Category;
import wtf.monsoon.api.module.Module;
import wtf.monsoon.api.setting.Setting;
import wtf.monsoon.api.util.misc.PacketSleepThread;
import wtf.monsoon.impl.event.EventPacket;

public class PingSpoof extends Module {

    @Getter
    private final Setting<Double> ping = new Setting<>("Ping", 100D)
            .minimum(20D)
            .maximum(1000D)
            .incrementation(1D)
            .describedBy("Your ping");

    public PingSpoof() {
        super("Ping Spoof", "Spoof your ping", Category.EXPLOIT);
        this.setMetadata(() -> String.valueOf(ping.getValue()));
    }

    @EventLink
    private final Listener<EventPacket> eventPacketListener = e -> {
        if (e.getDirection().equals(EventPacket.Direction.SEND)) {
            if (e.getPacket() instanceof C00PacketKeepAlive || e.getPacket() instanceof C0FPacketConfirmTransaction) {
                e.setCancelled(true);
                new PacketSleepThread(e.getPacket(), ping.getValue().longValue()).start();
            }
        }
    };


}
